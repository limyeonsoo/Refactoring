# 2. Refactoring Rule

### 리팩토링 (noun) & (verb)

> 소프트웨어의 겉보기 동작은 그대로 유치한 채.
1. 코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법.
2. 여러 가지 리팩터링 기법을 적용해서 소프트웨어를 재구성하다.

### ⭐ 리팩토링 과정에서 발견된 버그는 리팩터링 후에도 그대로 남아 있어야 한다.

→ 이유 : 리팩터링은 기능 추가 의 단계가 아니라, 코드 변경의 단계이다.

⇒ 수정 시점 : '기능 추가' 단계

⇒ 개발 시 : '기능 추가' → '리팩터링' → '기능 추가' → '리팩터링' → ... ... 반복.
(중간에 test를 이용하여 진척도 확인)

### But, 동작상 작은 수정.

1. 콜스택이 달라질 때 : 함수 추출하기 등으로 인해 콜스택 순서가 바뀔수 있음.
2. 모듈의 인터페이스 : 함수 옮기기 / 함수선언 바꾸기 등으로 인터페이스가 바뀔 수 있음.

### ⭐ 리팩토링 과정에서 성능이 나빠질 수 있다.

리팩토링의 목적은 코드의 이해도 향상이지, 성능은 관련없다.
→ '성능 최적화'단계에서 성능 향상 목표에 도달해야 한다.

## 리팩토링의 목적

1. 소프트웨어 설계가 좋아진다.
    - 아키텍처 이해가 됨. → 구조가 무너지지 않는다.
    - 중복 코드가 제거 됨.
2. 소프트웨어 이해가 쉬워진다.
    - 이해가 쉬우면 코드 수정이 쉽다.
    - 이해가 쉬우면 의사 전달이 쉽다.
    - 이해가 쉬우면 기억하기 쉽다.
3. 버그를 쉽게 찾을 수 있다.
    - 이해하기 쉬우니 버그를 쉽게 찾을 수 있다.
4. 프로그래밍 속도를 높일 수 있다.
    - 내부 설계 탄탄 & 가독성 개선 & 버그 감소 ⇒ 프로그래밍 속도 향상.
    - 모순이라 생각 할 수 있음. 리팩토링 시간이 오래 걸리니 속도가 느리지 않냐.

    ![2%20Refactoring%20Rule%20b269365299d14321abadca80e6c9f95c/Untitled.png](2%20Refactoring%20Rule%20b269365299d14321abadca80e6c9f95c/Untitled.png)

# 언제?

> Don Roberts :
1. 처음에는 그냥 한다.
2. 비슷한 일을 2번 하게 되면 계속 진행한다.
3. 비슷한 일을 3번 마주하게 되면 리팩터링 해야한다.

### 리팩터링 목적.

1. 준비를 하기 위한 리팩터링.

    : 기능을 추가하기 바로 직전이 가장 좋은 시점. → 구조를 살짝 바꾸면 다른 작업이 쉬워지는 장점을 살릴 수 있다.

2. 이해를 하기 위한 리팩터링.
    - 더 명확.
    - 다른사람이 보기 쉬움.
    - 머리 속에 것을 코드로 옮겨 표현 가능.
    - 코드가 깔끔해지면 눈에 뜨지않던 다른 설계도 눈에 들어오게 됨.
3. 쓰레기 줍기 위한 리펙터링.
    - 중복된 코드.
    - 하나의 함수로 합칠 수 있는 조각들.
    - 간단한 리팩터링 : 즉시
    걸리는 리팩터링 : 메모

### 계획된 리팩터링 or 수시로 하는 리팩터링.

if문을 쓸때 철저한 계획을 하지 않는 것 처럼 리팩터링도 프로그래밍의 일부 처럼 ⇒ 수시로

리팩터링이 그동안 소홀했다면, 규모가 커졌으므로 최대한 빨리 계획세우고 리팩터링.

리팩터링 커밋을 따로 분리할 필요가 없다. 시간 낭비가 될 수 있지만, 팀의 방식에 따라 적합하게.

### 코드리뷰 + 리팩터링

코드리뷰의 장점 : 

- 다른 사람의 아이디어를 얻을 수 있다.
- 자신의 관점이 아닌 다른 사람의 관점을 느낄 수 잇다.
- 절대로 떠올릴 수 없던 아이디어가 떠오를 수 있다.
- 팀원 모두가 이해할 수 있다.

### 리팩터링 하지 말아야 할 때

지저분하더라도 굳이 수정할 필요가 없다면 하지 않는다.

내부 동작에 대한 이해가 필요할 때 효과를 볼 수 있다.

처음부터 새로 시작하는게 더 낫다면 리팩터링하지 않는다.